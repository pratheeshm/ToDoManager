<!DOCTYPE html>
<html>
<head>
	<title>ToDo Manager</title>
	<link href="https://fonts.googleapis.com/css?family=Courgette" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Bevan|Courgette" rel="stylesheet">

	<script src = "https://code.jquery.com/jquery-2.1.3.min.js"
	type = "text/javascript"></script>
	<script src = "https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"
	type = "text/javascript"></script>
	<script src = "https://cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.2/backbone-min.js"
	type = "text/javascript"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/backbone-localstorage.js/1.0/backbone.localStorage-min.js" type="text/javascript"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>
	<link rel="stylesheet" type="text/css" href="styles.css">
</head>
<body class=" deep-orange accent-1" id="toDoContainer">
	<div class="input">
		<input type="text" name="" placeholder="What's On Your Mind?" class=" type-box  deep-orange-text text-darken-4 " id="input-todo">
		<a class="waves-effect waves-grey  white brown-text text-darken-4  btn z-depth-3" id="add">add</a>


	</div>
	<div class="actions ">
		<div class="action__container-todo  deep-orange darken-3 " id="toDoId">
			<div class="actions__head z-depth-5">TO  DO</div>
			<div class="todo-body" id="todoBody"> </div>
		</div>
		<div class="action__container-progress  deep-orange darken-3 " id="progressId">
			<div class="actions__head z-depth-5">IN  PROGRESS</div>
			<div class="progress-body" id="progressBody" ></div>
		</div>
		<div class="action__container-review  deep-orange darken-3 " id="reviewId">
			<div class="actions__head z-depth-5">IN  REVIEW</div>
			<div class="review-body" id="reviewBody"></div>
		</div>
		<div class="action__container-done  deep-orange darken-3 " id="doneId">
			<div class="actions__head z-depth-5">DONE</div>
			<div class="done-body" id="doneBody"></div>
		</div>
		<script type="text/template" id="template">
			<div class="row" draggable="true" >
				<div class="col s12 m6"  >
					<div class="card blue-grey darken-1" >
						<div class="card-content white-text">

							<p><%- text %></p>
						</div>
						<div class="card-action">
							<a class="waves-effect waves-light btn" id="delete">delete</a>

							
						</div>
					</div>
				</div>
			</div>
		</script>
		<script type="text/javascript">
			'use strict';
			var cnt=1;
	    //todo model
	    var toDoModel=Backbone.Model.extend({
	    	defaults:{
	    		text:"",
	    		completed:false
	    	}
	    	
	    });

	    // collection of todos

	    var toDoModels=Backbone.Collection.extend({
	    });
	    
	    var list=new toDoModels();

	    // single todo view
	    var todoView=Backbone.View.extend({
	    	model:new toDoModel(),
	    	tagName:'div',

	    	initialize:function(){

	    		this.model.on("destroy",this.remove,this);
	    		       // this.model.on('change', this.render, this);
	    		        $("#todoBody").bind("drop",this.drop_handler);
	    		        $("#progressBody").bind("drop",this.drop_handler);
	    		        $("#reviewBody").bind("drop",this.drop_handler);
	    		        $("#doneBody").bind("drop",this.drop_handler);
	    		       $("#todoBody").bind("dragover",this.dragover_handler);
	    		       $("#progressBody").bind("dragover",this.dragover_handler);
	    		       $("#reviewBody").bind("dragover",this.dragover_handler);
	    		       $("#doneBody").bind("dragover",this.dragover_handler);
	    		       for(var i=1;i<cnt;i++){
							$("#cardId"+String(i)).bind("dragstart",this.dragstart_handler);
	    		       }
	    		       // $("#cardId").bind("dragstart",this.dragstart_handler);
	    		       //this.$el.on("dragstart",this.dragstart_handler,this);
	    		   },
	    		   events:{
	    		   	"click #delete" : "destroy"

	    		   	// "dragstart #cardId":"dragstart_handler",
	    		   	
	    		   },
	    		   dragstart_handler:function(ev){
	    		   	console.log("dragStart");

	    		   	ev.dataTransfer.setData("text/plain",ev.target.id);
	    		   	ev.dropEffect = "move";

	    		   },
	    		   dragover_handler:function(ev){
	    		   	console.log("dragover");

	    		   	ev.preventDefault();
	    		   	ev.dataTransfer.dropEffect = "move";


	    		   },
	    		   drop_handler:function(ev){
	    		   	console.log("drop");

	    		   	ev.preventDefault();

	    		   	var data = ev.dataTransfer.getData("text");
	    		   	// ev.target.innerHTML=document.getElementById(data)
	    		   	ev.target.appendChild(document.getElementById(data));
	    		   	//this.model.set({"completed":true});
	    		   },
	    		   template:_.template($("#template").html()),
	    		   render:function(){
	    		   	this.$el.html(this.template(this.model.toJSON()));
	    		   	return this;
	    		   },
	    		   destroy:function(){
	    		   	this.model.destroy();
	    		   }



	    		});

	    // models view

	    var modelsView=Backbone.View.extend({
	    	model:list,
	    	el:"#toDoContainer",
	    	events:{
	    		"click #add" :"createToDo",
	    		"keypress #input-todo" :"createTodoByEnter"
	    	},
	    	initialize:function(){
	    		this.model.on("add",this.render,this);
	    		this.model.on("change",this.render,this);

	    	},
	    	createToDo:function(){
	    		if(  ! $("#input-todo").val().trim() ){
	    			return;
	    		}
	    		var a=this.createAttributes();
	    		list.add(a);
	    		$("#input-todo").val("");
	    	},
	    	createTodoByEnter:function(e){

	    		if( e.which!=13 || ! $("#input-todo").val().trim() ){
	    			return;
	    		}
	    		var a=this.createAttributes();
	    		list.add(a);
	    		$("#input-todo").val("");
	    	},
	    	createAttributes:function(){
	    		return{
	    			text:$("#input-todo").val().trim(),
	    			completed:false
	    		}
	    	},
	    	render:function(){
	    		var self=this;
	    		$("#todoBody").html("");
	    		_.each(this.model.toArray(),function(toDoModel){
	    			$("#todoBody").append(new todoView({model:toDoModel}).render().$el);
	    		}
	    		);
	    	}
	    });
	    jQuery.event.props.push('dataTransfer');

	    var modelsview = new modelsView();

	</script>
</div>
</body>
</html>